<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multi-API ChatGPT</title>
  <style>
    /* Reset and base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        "Helvetica Neue", Arial, sans-serif;
      background: #343541;
      color: #ffffff;
      height: 100vh;
      overflow: hidden;
    }

    .container {
      display: flex;
      height: 100vh;
    }

    /* Sidebar styles */
    .sidebar {
      width: 260px;
      background: #202123;
      display: flex;
      flex-direction: column;
      border-right: 1px solid #4d4d4f;
    }

    .sidebar-header {
      padding: 8px;
    }

    .new-chat-btn {
      width: 100%;
      background: transparent;
      border: 1px solid #4d4d4f;
      color: #ffffff;
      padding: 12px;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      transition: all 0.2s;
    }

    .new-chat-btn:hover {
      background: #2a2b32;
    }

    .plus-icon {
      font-size: 16px;
      font-weight: bold;
    }

    .chat-history {
      flex: 1;
      padding: 8px;
      overflow-y: auto;
    }

    .chat-item {
      padding: 12px;
      margin-bottom: 4px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .chat-item:hover {
      background: #2a2b32;
    }

    .chat-item.active {
      background: #343541;
    }

    .chat-title {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .sidebar-footer {
      padding: 8px;
      border-top: 1px solid #4d4d4f;
    }

    .telegram-channel {
      margin-bottom: 8px;
    }

    .telegram-link {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 6px;
      text-decoration: none;
      color: #ffffff;
      background: linear-gradient(135deg, #0088cc, #229ed9);
      transition: all 0.2s;
      font-size: 14px;
      font-weight: 500;
    }

    .telegram-link:hover {
      background: linear-gradient(135deg, #007bb5, #1a8bc8);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 136, 204, 0.3);
    }

    .telegram-link svg {
      flex-shrink: 0;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .user-info:hover {
      background: #2a2b32;
    }

    .user-avatar {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: #10a37f;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
    }

    .username {
      font-size: 14px;
    }

    /* Main content styles */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .chat-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    /* Welcome screen */
    .welcome-screen {
      text-align: center;
      max-width: 768px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .welcome-screen h1 {
      font-size: 48px;
      font-weight: 600;
      margin-bottom: 16px;
      background: linear-gradient(90deg, #10a37f, #1a73e8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .welcome-screen p {
      font-size: 20px;
      color: #c5c5d2;
      margin-bottom: 40px;
    }

    .example-prompts {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      max-width: 800px;
      margin: 0 auto;
    }

    .prompt-card {
      background: #40414f;
      border: 1px solid #565869;
      border-radius: 8px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
    }

    .prompt-card:hover {
      background: #4a4b56;
      transform: translateY(-2px);
    }

    .prompt-card h3 {
      font-size: 16px;
      margin-bottom: 8px;
      color: #ffffff;
    }

    .prompt-card p {
      font-size: 14px;
      color: #c5c5d2;
      line-height: 1.4;
    }

    /* Messages container */
    .messages-container {
      max-width: 768px;
      margin: 0 auto;
      width: 100%;
    }

    .message {
      margin-bottom: 24px;
      display: flex;
      gap: 16px;
      padding: 16px 0;
    }

    .message.user {
      background: transparent;
    }

    .message.assistant {
      background: #444654;
      margin-left: -20px;
      margin-right: -20px;
      padding-left: 20px;
      padding-right: 20px;
    }

    .message-avatar {
      width: 28px;
      height: 28px;
      border-radius: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      flex-shrink: 0;
    }

    .message.user .message-avatar {
      background: #5436da;
      color: white;
    }

    .message.assistant .message-avatar {
      background: #10a37f;
      color: white;
    }

    .message-content {
      flex: 1;
      line-height: 1.6;
      font-size: 16px;
    }

    .message-content pre {
      background: #1e1e1e;
      border: 1px solid #4d4d4f;
      border-radius: 6px;
      padding: 12px;
      overflow-x: auto;
      margin: 12px 0;
      font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
      font-size: 14px;
    }

    .message-content code {
      background: #1e1e1e;
      padding: 2px 4px;
      border-radius: 3px;
      font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
      font-size: 14px;
    }

    .typing-indicator {
      display: flex;
      align-items: center;
      gap: 4px;
      color: #c5c5d2;
    }

    .typing-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #10a37f;
      animation: typing 1.4s infinite;
    }

    .typing-dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typing {
      0%,
      60%,
      100% {
        transform: translateY(0);
        opacity: 0.4;
      }
      30% {
        transform: translateY(-10px);
        opacity: 1;
      }
    }

    /* Input area */
    .input-container {
      padding: 20px;
      background: #343541;
      border-top: 1px solid #4d4d4f;
    }

    .input-wrapper {
      max-width: 768px;
      margin: 0 auto;
      position: relative;
      background: #40414f;
      border-radius: 12px;
      border: 1px solid #565869;
      display: flex;
      align-items: flex-end;
      padding: 12px;
      gap: 8px;
    }

    .input-wrapper:focus-within {
      border-color: #10a37f;
      box-shadow: 0 0 0 1px #10a37f;
    }

    #messageInput {
      flex: 1;
      background: transparent;
      border: none;
      color: #ffffff;
      font-size: 16px;
      line-height: 1.5;
      resize: none;
      outline: none;
      font-family: inherit;
      max-height: 120px;
      min-height: 24px;
    }

    #messageInput::placeholder {
      color: #8e8ea0;
    }

    .send-btn {
      background: #10a37f;
      border: none;
      border-radius: 6px;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      color: white;
    }

    .send-btn:hover:not(:disabled) {
      background: #0d8a6b;
    }

    .send-btn:disabled {
      background: #565869;
      cursor: not-allowed;
    }

    .input-footer {
      text-align: center;
      margin-top: 12px;
    }

    .input-footer p {
      font-size: 12px;
      color: #8e8ea0;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        position: fixed;
        height: 100vh;
        z-index: 1000;
        transition: transform 0.3s;
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main-content {
        width: 100%;
      }

      .welcome-screen h1 {
        font-size: 36px;
      }

      .example-prompts {
        grid-template-columns: 1fr;
      }

      .message.assistant {
        margin-left: -20px;
        margin-right: -20px;
      }
    }

    /* Scrollbar styles */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: #4d4d4f;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #565869;
    }

    /* API status indicator */
    .api-status {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: #202123;
      border: 1px solid #4d4d4f;
      border-radius: 6px;
      padding: 8px 12px;
      font-size: 12px;
      color: #c5c5d2;
      z-index: 1000;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <button class="new-chat-btn" id="newChatBtn">
          <span class="plus-icon">+</span>
          New chat
        </button>
      </div>

      <div class="chat-history" id="chatHistory">
        <div class="chat-item active">
          <span class="chat-title">New conversation</span>
        </div>
      </div>

      <div class="sidebar-footer">
        <div class="telegram-channel">
          <a href="https://t.me/ThemeBazaar" target="_blank" rel="noopener noreferrer" class="telegram-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z" />
            </svg>
            <span>Join ThemeBazaar</span>
          </a>
        </div>

        <div class="user-info">
          <div class="user-avatar">U</div>
          <span class="username">User</span>
        </div>
      </div>
    </div>

    <!-- Main Chat Area -->
    <div class="main-content">
      <div class="chat-container" id="chatContainer">
        <div class="welcome-screen" id="welcomeScreen">
          <h1>Multi-API ChatGPT</h1>
          <p>Powered by 6 APIs: Alpha Vantage, FMP, Finnhub, Groq, Hugging Face, and NewsAPI</p>

          <div class="example-prompts">
            <div class="prompt-card" data-prompt="What's the current stock price of Apple (AAPL)?">
              <h3>ðŸ“ˆ Stock Information</h3>
              <p>Get current stock prices and financial data</p>
            </div>
            <div class="prompt-card" data-prompt="What are the latest news about artificial intelligence?">
              <h3>ðŸ“° Latest News</h3>
              <p>Get the latest news on any topic</p>
            </div>
            <div class="prompt-card" data-prompt="Explain quantum computing in simple terms">
              <h3>ðŸ§  AI Explanation</h3>
              <p>Get detailed explanations using AI models</p>
            </div>
            <div class="prompt-card" data-prompt="Analyze the current market trends for electric vehicles">
              <h3>ðŸ“Š Market Analysis</h3>
              <p>Get comprehensive market analysis</p>
            </div>
          </div>
        </div>

        <div class="messages-container" id="messagesContainer"></div>
      </div>

      <!-- Input Area -->
      <div class="input-container">
        <div class="input-wrapper">
          <textarea id="messageInput" placeholder="Ask me anything..." rows="1" maxlength="2000"></textarea>
          <button class="send-btn" id="sendBtn" disabled>
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path d="M.5 1.163A1 1 0 0 1 1.97.28l12.868 6.837a1 1 0 0 1 0 1.766L1.969 15.72A1 1 0 0 1 .5 14.836V10.33a1 1 0 0 1 .816-.983L8.5 8 1.316 6.653A1 1 0 0 1 .5 5.67V1.163Z" fill="currentColor" />
            </svg>
          </button>
        </div>
        <div class="input-footer">
          <p>Multi-API ChatGPT can make mistakes. Check important info.</p>
        </div>
      </div>
    </div>
  </div>

  <div class="api-status" id="apiStatus">Server: Connecting...</div>

  <script>
    class MultiAPIChatGPT {
      constructor() {
        this.conversations = [];
        this.currentConversationId = null;
        this.isTyping = false;
        this.apiStatus = document.getElementById('apiStatus');

        this.initializeElements();
        this.bindEvents();
        this.createNewConversation();
        this.checkServerStatus();
      }

      initializeElements() {
        this.messageInput = document.getElementById("messageInput");
        this.sendBtn = document.getElementById("sendBtn");
        this.messagesContainer = document.getElementById("messagesContainer");
        this.chatContainer = document.getElementById("chatContainer");
        this.welcomeScreen = document.getElementById("welcomeScreen");
        this.newChatBtn = document.getElementById("newChatBtn");
        this.chatHistory = document.getElementById("chatHistory");
      }

      bindEvents() {
        // Send button click
        this.sendBtn.addEventListener("click", () => this.sendMessage());

        // Enter key to send (Shift+Enter for new line)
        this.messageInput.addEventListener("keydown", (e) => {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            this.sendMessage();
          }
        });

        // Input change to toggle send button
        this.messageInput.addEventListener("input", () => {
          this.toggleSendButton();
          this.autoResize();
        });

        // New chat button
        this.newChatBtn.addEventListener("click", () =>
          this.createNewConversation()
        );

        // Example prompt cards
        document.querySelectorAll(".prompt-card").forEach((card) => {
          card.addEventListener("click", () => {
            const prompt = card.dataset.prompt;
            this.messageInput.value = prompt;
            this.toggleSendButton();
            this.sendMessage();
          });
        });

        // Chat history clicks
        this.chatHistory.addEventListener("click", (e) => {
          const chatItem = e.target.closest(".chat-item");
          if (chatItem) {
            const conversationId = parseInt(chatItem.dataset.id);
            this.switchConversation(conversationId);
          }
        });
      }

      autoResize() {
        this.messageInput.style.height = "auto";
        this.messageInput.style.height = this.messageInput.scrollHeight + "px";
      }

      toggleSendButton() {
        const hasContent = this.messageInput.value.trim().length > 0;
        this.sendBtn.disabled = !hasContent || this.isTyping;
      }

      createNewConversation() {
        const conversation = {
          id: Date.now(),
          title: "New conversation",
          messages: [],
          timestamp: new Date()
        };

        this.conversations.unshift(conversation);
        this.currentConversationId = conversation.id;

        this.updateChatHistory();
        this.renderMessages();
        this.showWelcomeScreen();

        // Clear input
        this.messageInput.value = "";
        this.toggleSendButton();
        this.messageInput.focus();
      }

      switchConversation(conversationId) {
        this.currentConversationId = conversationId;
        this.renderMessages();
        this.updateChatHistory();

        const conversation = this.getCurrentConversation();
        if (conversation.messages.length === 0) {
          this.showWelcomeScreen();
        } else {
          this.hideWelcomeScreen();
        }
      }

      getCurrentConversation() {
        return this.conversations.find(
          (conv) => conv.id === this.currentConversationId
        );
      }

      updateChatHistory() {
        this.chatHistory.innerHTML = "";

        this.conversations.forEach((conversation) => {
          const chatItem = document.createElement("div");
          chatItem.className = `chat-item ${
            conversation.id === this.currentConversationId ? "active" : ""
          }`;
          chatItem.dataset.id = conversation.id;

          chatItem.innerHTML = `
            <span class="chat-title">${this.escapeHtml(
              conversation.title
            )}</span>
          `;

          this.chatHistory.appendChild(chatItem);
        });
      }

      showWelcomeScreen() {
        this.welcomeScreen.style.display = "block";
        this.messagesContainer.style.display = "none";
      }

      hideWelcomeScreen() {
        this.welcomeScreen.style.display = "none";
        this.messagesContainer.style.display = "block";
      }

      async sendMessage() {
        const message = this.messageInput.value.trim();
        if (!message || this.isTyping) return;

        const conversation = this.getCurrentConversation();
        if (!conversation) return;

        // Hide welcome screen if this is the first message
        if (conversation.messages.length === 0) {
          this.hideWelcomeScreen();
          // Update conversation title with first message
          conversation.title =
            message.length > 30 ? message.substring(0, 30) + "..." : message;
          this.updateChatHistory();
        }

        // Add user message
        const userMessage = {
          id: Date.now(),
          role: "user",
          content: message,
          timestamp: new Date()
        };

        conversation.messages.push(userMessage);

        // Clear input and disable send button
        this.messageInput.value = "";
        this.autoResize();
        this.isTyping = true;
        this.toggleSendButton();

        // Render messages
        this.renderMessages();

        // Generate AI response using server API
        await this.generateAIResponse(conversation);
      }

      async generateAIResponse(conversation) {
        const userMessage =
          conversation.messages[conversation.messages.length - 1].content;

        // Add typing indicator
        const typingMessage = {
          id: "typing",
          role: "assistant",
          content: "typing",
          timestamp: new Date()
        };

        conversation.messages.push(typingMessage);
        this.renderMessages();

        try {
          // Send message to server API
          const response = await fetch('/api/chat', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ message: userMessage })
          });

          if (!response.ok) {
            throw new Error(`Server returned ${response.status}: ${response.statusText}`);
          }

          const data = await response.json();

          // Remove typing indicator
          conversation.messages.pop();

          const assistantMessage = {
            id: Date.now(),
            role: "assistant",
            content: data.response,
            timestamp: new Date()
          };

          conversation.messages.push(assistantMessage);
          this.updateApiStatus('Connected', true);

        } catch (error) {
          console.error("Error generating response:", error);
          
          // Remove typing indicator
          conversation.messages.pop();
          
          const errorMessage = {
            id: Date.now(),
            role: "assistant",
            content: "Sorry, I encountered an error while processing your request. Please try again later.",
            timestamp: new Date()
          };
          
          conversation.messages.push(errorMessage);
          this.updateApiStatus('Connection Error', false);
        }

        this.isTyping = false;
        this.toggleSendButton();
        this.renderMessages();
        this.messageInput.focus();
      }

      async checkServerStatus() {
        try {
          const response = await fetch('/api/status');
          if (response.ok) {
            this.updateApiStatus('Connected', true);
          } else {
            this.updateApiStatus('Server Error', false);
          }
        } catch (error) {
          this.updateApiStatus('Offline', false);
        }
      }

      updateApiStatus(status, isConnected) {
        this.apiStatus.textContent = `Server: ${status}`;
        this.apiStatus.style.color = isConnected ? '#10a37f' : '#ef4444';
      }

      renderMessages() {
        const conversation = this.getCurrentConversation();
        if (!conversation) return;

        this.messagesContainer.innerHTML = "";

        conversation.messages.forEach((message) => {
          const messageElement = this.createMessageElement(message);
          this.messagesContainer.appendChild(messageElement);
        });

        // Scroll to bottom
        this.chatContainer.scrollTop = this.chatContainer.scrollHeight;
      }

      createMessageElement(message) {
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${message.role}`;

        const avatarDiv = document.createElement("div");
        avatarDiv.className = "message-avatar";
        avatarDiv.textContent = message.role === "user" ? "U" : "AI";

        const contentDiv = document.createElement("div");
        contentDiv.className = "message-content";

        if (message.content === "typing") {
          contentDiv.innerHTML = `
            <div class="typing-indicator">
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
            </div>
          `;
        } else {
          contentDiv.innerHTML = this.formatMessage(message.content);
        }

        messageDiv.appendChild(avatarDiv);
        messageDiv.appendChild(contentDiv);

        return messageDiv;
      }

      formatMessage(content) {
        // Handle code blocks
        content = content.replace(
          /```(\w+)?\n([\s\S]*?)```/g,
          "<pre><code>$2</code></pre>"
        );

        // Handle inline code
        content = content.replace(/`([^`]+)`/g, "<code>$1</code>");

        // Handle bold text
        content = content.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");

        // Handle line breaks
        content = content.replace(/\n/g, "<br>");

        return content;
      }

      escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      delay(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }
    }

    // Initialize the chat application when the page loads
    document.addEventListener("DOMContentLoaded", () => {
      new MultiAPIChatGPT();
    });

    // Handle mobile sidebar toggle
    function toggleSidebar() {
      const sidebar = document.querySelector(".sidebar");
      sidebar.classList.toggle("open");
    }

    // Add click outside to close sidebar on mobile
    document.addEventListener("click", (e) => {
      const sidebar = document.querySelector(".sidebar");
      const isMobile = window.innerWidth <= 768;

      if (
        isMobile &&
        sidebar.classList.contains("open") &&
        !sidebar.contains(e.target)
      ) {
        sidebar.classList.remove("open");
      }
    });
  </script>
</body>
</html>
